
<link rel="import" href="../bower_components/pvc-globals/pvc-globals.html">
<link rel="import" href="../bower_components/marked-element/marked-element.html">
<link rel="import" href="../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../bower_components/core-icon-button/core-icon-button.html">

<link rel="import" href="../elements/site-overlay/site-overlay.html">
<link rel="import" href="../elements/site-ajax/site-ajax.html">
<link rel="import" href="../elements/site-style/site-style.html">
<link rel="import" href="../elements/site-comments/site-comments.html">

<polymer-element name="session-show" attributes="sessionId router">
	<template>
		<pvc-globals values="{{globals}}"></pvc-globals>
		<core-style ref="main"></core-style>
		<h1>{{resource}}</h1>
		<site-ajax url="/sessions/{{sessionId}}" on-core-response="{{handleSession}}"></site-ajax>
		<site-overlay id="overlay" opened backdrop layered on-core-overlay-close-completed="{{onClose}}" transition="core-transition-center">
			<core-style ref="main"></core-style>
			<style>
				#close {
					position: absolute;
					right: 8px;
					top: 8px;
					background: #fff;
				}
				#title {
					min-height: 32px;
					margin-right: 54px;
					margin-bottom: 0;
				}
				#spinner {
					position: absolute;
					left: 50%;
					margin-left: -14px;
					top: 50%;
					margin-top: -14px;
				}
				.card__container {
					width: 2048px;
				}
				.card {
					min-height: 30vh;
				}
				dt {
					float: left;
					width: 160px;
					overflow: hidden;
					clear: left;
					text-align: right;
					text-overflow: ellipsis;
					white-space: nowrap;
					font-weight: bold;
				}

				dd {
					margin-left: 180px;
				}

				dd.theme span:not(:last-child):after {
					content: ', ';
				}

				@media (min-width: 768px) {
					.card .card__content {
						padding: 16px 32px;
					}
				}
			</style>
			<div class="card__container container">
				<div class="card">
					<paper-spinner id="spinner" active?="{{!session}}" hidden?="{{session}}"></paper-spinner>
					<div class="card__content">
						<core-icon-button id="close" icon="clear" core-overlay-toggle></core-icon-button>
						<h1 id="title" site-font="headline">{{session.title}}</h1>
					</div>
					<div class="card__content">
						<div layout horizontal>
							<div flex>
								<marked-element text="{{session.description}}"></marked-element>
							</div>
							<dl>
								<dt>Themes:</dt>
								<dd class="theme"><template repeat="{{theme in session.themes}}"><span>{{theme.title}}</span></template></dd>
								<dt>Type:</dt>
								<dd>{{session.type}}</dd>
								<dt>Expertise level:</dt>
								<dd>{{session.expertiseLevel}}</dd>
							</dl>
						</div>
					</div>
					<div class="card__content">
						<template if="{{$.overlay.opened}}">
							<site-comments></site-comments>
						</template>
					</div>
				</div>
			</div>
		</site-overlay>
	</template>
	<script>
		Polymer({
			session: null,
			handleSession: function(event) {
				this.session = event.detail.response;
				this.fire('session-open', this.session);
			},
			onClose: function() {
				this.session = null;
				this.fire('session-close');
			}
		});
	</script>
</polymer-element>
