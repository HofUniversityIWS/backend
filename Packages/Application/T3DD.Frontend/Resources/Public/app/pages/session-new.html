<link rel="import" href="../bower_components/core-scroll-header-panel/core-scroll-header-panel.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/marked-element/marked-element.html">

<link rel="import" href="../elements/site-form/site-form.html">
<link rel="import" href="../elements/site-ajax/site-ajax.html">
<link rel="import" href="../bower_components/marked-element/marked-element.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-autogrow-textarea.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../elements/site-overlay-spinner/site-overlay-spinner.html">

<polymer-element name="session-new">
	<template>
		<core-style ref="main"></core-style>
		<style>
			:host, core-scroll-header-panel {
				display: block;
				height: 100%;
			}

			.session {
				padding: 32px;
			}

			paper-autogrow-textarea {
				width: 100%;
				margin-bottom: 30px;
			}
		</style>
		<site-ajax url="/values" response="{{values}}"></site-ajax>
		<core-scroll-header-panel>
			<core-toolbar>
				<div>Register a new session</div>
			</core-toolbar>
			<div class="session" horizontal layout>
				<form id="form" is="site-form" action="/sessions" method="post" enctype="application/json" headers='{"Accept": "application/json"}' flex>
					<paper-input-decorator label="Session title" floatingLabel error="Enter a session title!">
						<input name="title" value="{{formData.title}}" is="core-input" required>
					</paper-input-decorator>
					<paper-input-decorator label="Describe your session" floatingLabel error="Enter a session description!">
						<paper-autogrow-textarea rows="10">
							<textarea name="description" placeholder="Describe your session" value="{{formData.description}}" required></textarea>
						</paper-autogrow-textarea>
					</paper-input-decorator>

					<fieldset>
						<h4>Select your theme</h4>
						<paper-radio-group selected="{{formData.theme}}">
							<template repeat="{{v in values.theme}}">
								<paper-radio-button name="{{v.identifier}}" label="{{v.title}}"></paper-radio-button>
							</template>
						</paper-radio-group>
						<input name="theme" value="{{formData.theme}}" is="core-input" required hidden>

						<h4>Select your type</h4>
						<paper-radio-group selected="{{formData.type}}">
							<template repeat="{{v in values.type}}">
								<paper-radio-button name="{{v.identifier}}" label="{{v.title}}"></paper-radio-button>
							</template>
						</paper-radio-group>
						<input name="type" value="{{formData.type}}" is="core-input" required hidden>

						<h4>Select the expertise level of the session</h4>
						<paper-radio-group selected="{{formData.expertiseLevel}}">
							<template repeat="{{v in values.expertiseLevel}}">
								<paper-radio-button name="{{v.identifier}}" label="{{v.title}}"></paper-radio-button>
							</template>
						</paper-radio-group>
						<input name="expertiseLevel" value="{{formData.expertiseLevel}}" is="core-input" required hidden>
					</fieldset>

					<paper-button on-click="{{submit}}">
						<core-icon icon="check"></core-icon>
						Register
					</paper-button>
					<site-overlay-spinner active="{{$.form.isSubmitting}}"></site-overlay-spinner>
				</form>
				<div class="preview" flex>
					<h3>{{formData.title}}</h3>
					<marked-element text="{{formData.description}}"></marked-element>
				</div>
			</div>
		</core-scroll-header-panel>
	</template>
	<script>
		(function () {
			'use strict';
			Polymer({
				formData: {
					title: '',
					description: '',
					timestamp: new Date().getTime()
				},
				ready: function () {
					this.$.form.addEventListener('submitted', this.$.form.changePageToResource);
				},
				submit: function () {
					this.$.form.submit();
				}
			});

		})();
	</script>
</polymer-element>
